apiVersion: v2
name: helm-chart-backoffice
namespace: whatnow-cluster
description: Helm chart to deploy Laravel API - Staging Environment
version: 0.1.0
appVersion: "1.0.0"
# Azure Container Registry details
image:
    repository: ifrcsmdb.azurecr.io/whatnow
    tag: "develop"
    pullPolicy: Always

replicaCount: 1

# Kubernetes service configuration
service:
    type: ClusterIP
    port: 80
    targetPort: 80
# Environment variables
env:
    APP_NAME: 'IFRC Safety Messages Database - Staging'
    APP_ENV: staging
    APP_DEBUG: true
    APP_LOG_LEVEL: debug
    APP_URL: https://preparemessages-stage.ifrc.org
    GOOGLE_MAPS_KEY:
    DB_CONNECTION: mysql
    DB_PORT: 3306
    BROADCAST_DRIVER: log
    CACHE_DRIVER: file
    SESSION_DRIVER: file
    QUEUE_DRIVER: sync
    REDIS_HOST: redis
    REDIS_PASSWORD: null
    REDIS_PORT: 6379
    MAIL_DRIVER: smtp
    MAIL_HOST: smtp.azurecomm.net
    MAIL_PORT: 587
    MAIL_ENCRYPTION: tls
    MAIL_USER: Whatnow
    MAIL_FROM_ADDRESS: DoNotReply@email.whatnow.jazusoft.com
    PUSHER_APP_ID:
    PUSHER_APP_KEY:
    PUSHER_APP_SECRET:
    RCN_API_VERSION: v1
    FACEBOOK_APP_ID:
    FACEBOOK_APP_SECRET:
    GOOGLE_CLIENT_ID:
    GOOGLE_CLIENT_SECRET:
    GOOGLE_ANALYTICS_TRACKER_ID:
    SENTRY_DSN:
    TRANSIFEX_API_TOKEN:
    TRANSIFEX_PROJECT:
    TRANSIFEX_SLUG:
    BUCKET_URL: https://smdbstorageaccount.blob.core.windows.net/images-staging


secrets:
    dbSecretName: backoffice-staging-credentials
    variables:
        DB_HOST: BACKOFFICE_DB_HOST_STAGING
        DB_DATABASE: BACKOFFICE_DB_DATABASE_STAGING
        DB_USERNAME: BACKOFFICE_DB_USERNAME_STAGING
        DB_PASSWORD: BACKOFFICE_DB_PASSWORD_STAGING
        APP_KEY: BACKOFFICE_APP_KEY_STAGING
        JWT_SECRET: BACKOFFICE_JWT_SECRET_STAGING
        RCN_API_URL: BACKOFFICE_RCN_API_URL_STAGING
        RCN_API_USER: BACKOFFICE_RCN_API_USER_STAGING
        RCN_API_PASSWORD: BACKOFFICE_RCN_API_PASSWORD_STAGING
        MAIL_ENDPOINT: MAIL_ENDPOINT_STAGING
        MAIL_FROM: MAIL_FROM_STAGING
        MAIL_API_KEY: MAIL_API_KEY_STAGING


ingress:
    enabled: true
    annotations:
        kubernetes.io/ingress.class: nginx
        nginx.ingress.kubernetes.io/ssl-redirect: "true"
        nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
    hosts:
        - host: "preparemessages-stage.ifrc.org"
          paths:
              - path: /
                pathType: Prefix
    tls:
        - hosts:
              - "preparemessages-stage.ifrc.org"
          secretName: "ifrc.certificates.secret"
